<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 7) & !(IE 8)]><!-->
<html lang="en-US">
<!--<![endif]-->
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<title>Part 2: Serializing and deserializing strokes | WILL SDK Docs</title>
	<link rel="profile" href="http://gmpg.org/xfn/11">
	<link rel="pingback" href="http://localhost/will_docs_instance1/xmlrpc.php">
	<!--[if lt IE 9]>
	<script src="http://localhost/will_docs_instance1/wp-content/themes/will-doc/js/html5.js"></script>
	<![endif]-->

	<link rel="stylesheet" href="../../wp-content/themes/will-doc/css/style.css">
	<link rel="stylesheet" href="../../wp-content/themes/will-doc/css/accordionmenu.css">

	<script src="../../wp-content/themes/will-doc/js/jquery.min.js"></script>
	<script src="../../wp-content/themes/will-doc/js/sidebar.js"></script>

	<link rel="stylesheet" href="../../wp-content/themes/will-doc/css/highlight.css">
	<script src="../../wp-content/themes/will-doc/js/highlight.pack.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
</head>

<body>
	<header>
		<div class="title">
			<div>WILL &trade;</div>
			<div>sdk documentation</div>
		</div>
		<!--
		<div id="searchbox">
			<input class="typeahead" type="text" placeholder="{{ search_text }}">
		</div>
-->
	</header>

	<div id="sitewrapper">
<div id="sidebar">
	<nav class="accordion">

				<h1 class="do-not-cause-collapse" title="General Concepts">

			General Concepts
			</h1>

							<div class="active-menu never-close">
					<h2 class="not-collapsible" title="Architectural Overview">

								<a href="../../general-concepts/architecture/index.html"
											>Architectural Overview</a>
					
			</h2>

						<h2 class="not-collapsible" title="Generating ink content">

								<a href="../../general-concepts/path-building/index.html"
											>Generating ink content</a>
					
			</h2>

						<h2 class="not-collapsible" title="Rendering ink content">

								<a href="../../general-concepts/rasterizer/index.html"
											>Rendering ink content</a>
					
			</h2>

						<h2 class="not-collapsible" title="Encoding and decoding ink content">

								<a href="../../general-concepts/serialization/index.html"
											>Encoding and decoding ink content</a>
					
			</h2>

						<h2 class="not-collapsible" title="Exchanging ink content">

								<a href="../../general-concepts/file-format/index.html"
											>Exchanging ink content</a>
					
			</h2>

							</div>
							<h1 title="iOS SDK">

			iOS SDK
			</h1>

							<div>
					<h2 title="Getting started">

								<a href="../getting-started/index.html"
											>Getting started</a>
					
			</h2>

						<h2 title="Release Notes">

								<a href="../release-notes/index.html"
											>Release Notes</a>
					
			</h2>

						<h2 title="Tutorials Overview">

								<a href="../tutorials/index.html"
											>Tutorials Overview</a>
					
			</h2>

							<div>
					<h3 title="Tutorial 1: Drawing with touch">

								<a href="../tutorials-tutorial1/index.html"
											>Tutorial 1: Drawing with touch</a>
					
			</h3>

							<div>
					<h4 title="Part 1: Setting up the ink engine">

								<a href="../tutorials-tutorial1-part1/index.html"
											>Part 1: Setting up the ink engine</a>
					
			</h4>

						<h4 title="Part 2: Building paths from touch input">

								<a href="../tutorials-tutorial1-part2/index.html"
											>Part 2: Building paths from touch input</a>
					
			</h4>

						<h4 title="Part 3: Smoothing paths">

								<a href="../tutorials-tutorial1-part3/index.html"
											>Part 3: Smoothing paths</a>
					
			</h4>

						<h4 title="Part 4: Drawing semi-transparent strokes">

								<a href="../tutorials-tutorial1-part4/index.html"
											>Part 4: Drawing semi-transparent strokes</a>
					
			</h4>

						<h4 title="Part 5: Drawing preliminary paths">

								<a href="../tutorials-tutorial1-part5/index.html"
											>Part 5: Drawing preliminary paths</a>
					
			</h4>

						<h4 title="Part 6: Using a particle brush">

								<a href="../tutorials-tutorial1-part6/index.html"
											>Part 6: Using a particle brush</a>
					
			</h4>

						<h4 title="Part 7: Generating a Bezier path">

								<a href="../tutorials-tutorial1-part7/index.html"
											>Part 7: Generating a Bezier path</a>
					
			</h4>

							</div>
							<h3 title="Tutorial 2: Encoding and decoding strokes">

								<a href="../tutorials-tutorial2/index.html"
											>Tutorial 2: Encoding and decoding strokes</a>
					
			</h3>

							<div>
					<h4 title="Part 1: Creating a stroke model">

								<a href="../tutorials-tutorial2-part1/index.html"
											>Part 1: Creating a stroke model</a>
					
			</h4>

						<h4 title="Part 2: Serializing and deserializing strokes">

								<a href="index.html"
						 class="selected"					>Part 2: Serializing and deserializing strokes</a>
					
			</h4>

							</div>
							<h3 title="Tutorial 3: Erasing strokes">

								<a href="../tutorials-tutorial3/index.html"
											>Tutorial 3: Erasing strokes</a>
					
			</h3>

							<div>
					<h4 title="Part 1: Extending the stroke model">

								<a href="../tutorials-tutorial3-part1/index.html"
											>Part 1: Extending the stroke model</a>
					
			</h4>

						<h4 title="Part 2: Creating an eraser">

								<a href="../tutorials-tutorial3-part2/index.html"
											>Part 2: Creating an eraser</a>
					
			</h4>

						<h4 title="Part 3: Erasing parts of strokes">

								<a href="../tutorials-tutorial3-part3/index.html"
											>Part 3: Erasing parts of strokes</a>
					
			</h4>

							</div>
							<h3 title="Tutorial 4: Selecting strokes">

								<a href="../tutorials-tutorial4/index.html"
											>Tutorial 4: Selecting strokes</a>
					
			</h3>

							<div>
					<h4 title="Part 1: Selecting whole strokes">

								<a href="../tutorials-tutorial4-part1/index.html"
											>Part 1: Selecting whole strokes</a>
					
			</h4>

						<h4 title="Part 2: Selecting parts of strokes">

								<a href="../tutorials-tutorial4-part2/index.html"
											>Part 2: Selecting parts of strokes</a>
					
			</h4>

							</div>
							<h3 title="Tutorial 5: Working with rasters">

								<a href="../tutorials-tutorial5/index.html"
											>Tutorial 5: Working with rasters</a>
					
			</h3>

							<div>
					<h4 title="Part 1: Displaying raster images">

								<a href="../tutorials-tutorial5-part1/index.html"
											>Part 1: Displaying raster images</a>
					
			</h4>

						<h4 title="Part 2: Creating image masks">

								<a href="../tutorials-tutorial5-part2/index.html"
											>Part 2: Creating image masks</a>
					
			</h4>

							</div>
								</div>
							<h2 title="API Reference">

			API Reference
			</h2>

							<div>
					<h3 title="Classes">

			Classes
			</h3>

							<div>
					<h4 title="WCMAbstractPathBuilder">

								<a href="../api-WCMAbstractPathBuilder/index.html"
											>WCMAbstractPathBuilder</a>
					
			</h4>

						<h4 title="WCMBezierPathUtils">

								<a href="../api-WCMBezierPathUtils/index.html"
											>WCMBezierPathUtils</a>
					
			</h4>

						<h4 title="WCMCGRectVector">

								<a href="../api-WCMCGRectVector/index.html"
											>WCMCGRectVector</a>
					
			</h4>

						<h4 title="WCMDirectStrokeBrush">

								<a href="../api-WCMDirectStrokeBrush/index.html"
											>WCMDirectStrokeBrush</a>
					
			</h4>

						<h4 title="WCMDocument">

								<a href="../api-WCMDocument/index.html"
											>WCMDocument</a>
					
			</h4>

						<h4 title="WCMDocumentContentType">

								<a href="../api-WCMDocumentContentType/index.html"
											>WCMDocumentContentType</a>
					
			</h4>

						<h4 title="WCMDocumentProperties">

								<a href="../api-WCMDocumentProperties/index.html"
											>WCMDocumentProperties</a>
					
			</h4>

						<h4 title="WCMDocumentResource">

								<a href="../api-WCMDocumentResource/index.html"
											>WCMDocumentResource</a>
					
			</h4>

						<h4 title="WCMDocumentSection">

								<a href="../api-WCMDocumentSection/index.html"
											>WCMDocumentSection</a>
					
			</h4>

						<h4 title="WCMDocumentSectionContainer">

								<a href="../api-WCMDocumentSectionContainer/index.html"
											>WCMDocumentSectionContainer</a>
					
			</h4>

						<h4 title="WCMDocumentSectionElement">

								<a href="../api-WCMDocumentSectionElement/index.html"
											>WCMDocumentSectionElement</a>
					
			</h4>

						<h4 title="WCMDocumentSectionGroup">

								<a href="../api-WCMDocumentSectionGroup/index.html"
											>WCMDocumentSectionGroup</a>
					
			</h4>

						<h4 title="WCMDocumentSectionImage">

								<a href="../api-WCMDocumentSectionImage/index.html"
											>WCMDocumentSectionImage</a>
					
			</h4>

						<h4 title="WCMDocumentSectionPaths">

								<a href="../api-WCMDocumentSectionPaths/index.html"
											>WCMDocumentSectionPaths</a>
					
			</h4>

						<h4 title="WCMDocumentSectionRect">

								<a href="../api-WCMDocumentSectionRect/index.html"
											>WCMDocumentSectionRect</a>
					
			</h4>

						<h4 title="WCMDocumentSectionView">

								<a href="../api-WCMDocumentSectionView/index.html"
											>WCMDocumentSectionView</a>
					
			</h4>

						<h4 title="WCMFloatVector">

								<a href="../api-WCMFloatVector/index.html"
											>WCMFloatVector</a>
					
			</h4>

						<h4 title="WCMFloatVectorPointer">

								<a href="../api-WCMFloatVectorPointer/index.html"
											>WCMFloatVectorPointer</a>
					
			</h4>

						<h4 title="WCMInkDecoder">

								<a href="../api-WCMInkDecoder/index.html"
											>WCMInkDecoder</a>
					
			</h4>

						<h4 title="WCMInkEncoder">

								<a href="../api-WCMInkEncoder/index.html"
											>WCMInkEncoder</a>
					
			</h4>

						<h4 title="WCMIntVector">

								<a href="../api-WCMIntVector/index.html"
											>WCMIntVector</a>
					
			</h4>

						<h4 title="WCMIntersector">

								<a href="../api-WCMIntersector/index.html"
											>WCMIntersector</a>
					
			</h4>

						<h4 title="WCMLayer">

								<a href="../api-WCMLayer/index.html"
											>WCMLayer</a>
					
			</h4>

						<h4 title="WCMMultiChannelSmoothener">

								<a href="../api-WCMMultiChannelSmoothener/index.html"
											>WCMMultiChannelSmoothener</a>
					
			</h4>

						<h4 title="WCMPaintDecoder">

								<a href="../api-WCMPaintDecoder/index.html"
											>WCMPaintDecoder</a>
					
			</h4>

						<h4 title="WCMPaintEncoder">

								<a href="../api-WCMPaintEncoder/index.html"
											>WCMPaintEncoder</a>
					
			</h4>

						<h4 title="WCMParticlePaint">

								<a href="../api-WCMParticlePaint/index.html"
											>WCMParticlePaint</a>
					
			</h4>

						<h4 title="WCMParticleStrokeBrush">

								<a href="../api-WCMParticleStrokeBrush/index.html"
											>WCMParticleStrokeBrush</a>
					
			</h4>

						<h4 title="WCMPathAppendResult">

								<a href="../api-WCMPathAppendResult/index.html"
											>WCMPathAppendResult</a>
					
			</h4>

						<h4 title="WCMPressurePathBuilder">

								<a href="../api-WCMPressurePathBuilder/index.html"
											>WCMPressurePathBuilder</a>
					
			</h4>

						<h4 title="WCMRIFFChunk">

								<a href="../api-WCMRIFFChunk/index.html"
											>WCMRIFFChunk</a>
					
			</h4>

						<h4 title="WCMRIFFDecoder">

								<a href="../api-WCMRIFFDecoder/index.html"
											>WCMRIFFDecoder</a>
					
			</h4>

						<h4 title="WCMRIFFEncoder">

								<a href="../api-WCMRIFFEncoder/index.html"
											>WCMRIFFEncoder</a>
					
			</h4>

						<h4 title="WCMRenderingContext">

								<a href="../api-WCMRenderingContext/index.html"
											>WCMRenderingContext</a>
					
			</h4>

						<h4 title="WCMSmoothener">

								<a href="../api-WCMSmoothener/index.html"
											>WCMSmoothener</a>
					
			</h4>

						<h4 title="WCMSmoothenerFinisher">

								<a href="../api-WCMSmoothenerFinisher/index.html"
											>WCMSmoothenerFinisher</a>
					
			</h4>

						<h4 title="WCMSolidColorStrokeBrush">

								<a href="../api-WCMSolidColorStrokeBrush/index.html"
											>WCMSolidColorStrokeBrush</a>
					
			</h4>

						<h4 title="WCMSpeedPathBuilder">

								<a href="../api-WCMSpeedPathBuilder/index.html"
											>WCMSpeedPathBuilder</a>
					
			</h4>

						<h4 title="WCMStrokeBrush">

								<a href="../api-WCMStrokeBrush/index.html"
											>WCMStrokeBrush</a>
					
			</h4>

						<h4 title="WCMStrokeRenderer">

								<a href="../api-WCMStrokeRenderer/index.html"
											>WCMStrokeRenderer</a>
					
			</h4>

						<h4 title="WCMTransformableProtocol">

								<a href="../api-WCMTransformableProtocol/index.html"
											>WCMTransformableProtocol</a>
					
			</h4>

						<h4 title="WCMVersion">

								<a href="../api-WCMVersion/index.html"
											>WCMVersion</a>
					
			</h4>

						<h4 title="WCMWILLFileFormatDecoder">

								<a href="../api-WCMWILLFileFormatDecoder/index.html"
											>WCMWILLFileFormatDecoder</a>
					
			</h4>

						<h4 title="WCMWILLFileFormatEncoder">

								<a href="../api-WCMWILLFileFormatEncoder/index.html"
											>WCMWILLFileFormatEncoder</a>
					
			</h4>

							</div>
							<h3 title="Constants">

			Constants
			</h3>

							<div>
					<h4 title="WCMBlendMode">

								<a href="../api-WCMBlendMode/index.html"
											>WCMBlendMode</a>
					
			</h4>

						<h4 title="WCMInputPhase">

								<a href="../api-WCMInputPhase/index.html"
											>WCMInputPhase</a>
					
			</h4>

						<h4 title="WCMPropertyFunction">

								<a href="../api-WCMPropertyFunction/index.html"
											>WCMPropertyFunction</a>
					
			</h4>

						<h4 title="WCMPropertyName">

								<a href="../api-WCMPropertyName/index.html"
											>WCMPropertyName</a>
					
			</h4>

						<h4 title="WCMStrokeBrushRotation">

								<a href="../api-WCMStrokeBrushRotation/index.html"
											>WCMStrokeBrushRotation</a>
					
			</h4>

							</div>
							<h3 title="Index">

								<a href="../api-index/index.html"
											>Index</a>
					
			</h3>

						<h3 title="Hierarchy">

								<a href="../api-hierarchy/index.html"
											>Hierarchy</a>
					
			</h3>

			
	</nav>
</div><div id="page_content" class='page-content tutorials ios'>
	<div class="seealso"><h2>See Also</h2><p>For more information, see the following topic:</p><ul><li><a href="../../general-concepts/serialization/index.html">Encoding and decoding ink content</a></li></ul></div>
<div id="post-75" class="page">
	<h1>Encoding and decoding strokes</h1>
<h2>Part 2: Serializing and deserializing strokes</h2>
<p>WILL SDK provides the <a href="../api-WCMInkDecoder/index.html"><code>WCMInkDecoder</code></a> and <a href="../api-WCMInkEncoder/index.html"><code>WCMInkEncoder</code></a> classes. The <a href="../api-WCMInkEncoder/index.html"><code>WCMInkEncoder</code></a> class creates a compressed binary representation for a collection of strokes. The <a href="../api-WCMInkDecoder/index.html"><code>WCMInkDecoder</code></a> class reads this binary data and recreates the strokes. The <a href="../api-WCMDocument/index.html"><code>WCMDocument</code></a> class can then encode the stroke data in a WILL Document file.</p>
<p>In Part 2 of this tutorial, you will use these classes to encode and decode strokes.</p>
<h3>Step 1: Encode the strokes using the ink encoder</h3>
<p>The encoding process is straightforward.</p>
<p>Create a <a href="../api-WCMInkEncoder/index.html"><code>WCMInkEncoder</code></a> instance and call the <code>encodePathWithPrecision:</code> method for each stroke in your collection.</p>
<p>Call <code>getBytes</code>. The only parameter whose purpose is not clear is the <code>decimalScale</code> parameter. This parameter is used when the stroke coordinates are converted from floating-point numbers to fixed-point numbers. It specifies the number of digits after the decimal point (in base 10) to store. In most cases, two digits is enough.</p>
<p>The other parameters of the <code>encodePathWithPrecision</code> method are as follows:</p>
<ul>
<li><code>points</code></li>
<li><code>stride</code></li>
<li><code>width</code></li>
<li><code>color</code></li>
<li><code>ts</code></li>
<li><code>tf</code></li>
</ul>
<p>For more information about the parameters, see the reference documentation for <a href="../api-WCMInkEncoder/index.html"><code>WCMInkEncoder</code></a>.</p>
<h3>Step 2: Create a document to store the encoded strokes</h3>
<p>Create an instance of the <a href="../api-WCMDocument/index.html"><code>WCMDocument</code></a> class.</p>
<p>Create a new instance of the <a href="../api-WCMDocumentSection/index.html"><code>WCMDocumentSection</code></a> class. This class represents a scene inside the document. Each scene can contain strokes, images, and other graphic elements. In this tutorial, the scene contains strokes only.</p>
<h3>Step 3: Store the encoded strokes in the document</h3>
<p>To store the strokes, create an instance of the <a href="../api-WCMDocumentSectionPaths/index.html"><code>WCMDocumentSectionPaths</code></a> class.</p>
<p>Set the content of the paths element instance with the binary data produced by the <a href="../api-WCMInkDecoder/index.html"><code>WCMInkDecoder</code></a> class.</p>
<p>Add the section to the document and the paths element to the section.</p>
<p>Call the <code>createDocumentAtPath:</code> method as follows:</p>
<pre><code class="objectivec">- (void) saveStrokes:(NSMutableArray*)strokes toPath:(NSString*)path
{
    WCMInkEncoder * inkEncoder = [[WCMInkEncoder alloc] init];
    for (Stroke * s in strokes)
    {
        [inkEncoder encodePathWithPrecision:2 andPoints:s.points andStride:s.stride andWidth:s.width andColor:s.color andTs:0 andTf:1 andBlendMode:WCMBlendModeNormal];
    }

    NSData * inkData = [inkEncoder getBytes];

    WCMDocument * doc = [[WCMDocument alloc] init];

    WCMDocumentSection * section = [[WCMDocumentSection alloc] init];
    section.size = self.view.bounds.size;

    WCMDocumentSectionPaths * pathsElement = [[WCMDocumentSectionPaths alloc] init];
    [pathsElement.content setData:inkData withType:[WCMDocumentContentType STROKES]];

    [doc.sections addObject:section];
    [section addElement:pathsElement];

    [doc createDocumentAtPath:path];
}</code></pre>
<h3>Step 4: Load the file with the file format decoder</h3>
<p>The decoding process is also straightforward.</p>
<p>Create a <a href="../api-WCMDocument/index.html"><code>WCMDocument</code></a> instance and load the data from the file using the <code>loadDocumentAtPath:</code> method.</p>
<h3>Step 5: Find the encoded ink in the document</h3>
<p>To obtain the encoded ink, take the first section in the document and then the first subelement of that section. This subelement should be a paths element (an instance of <a href="../api-WCMDocumentSectionPaths/index.html"><code>WCMDocumentSectionPaths</code></a>).</p>
<h3>Step 6: Decode the strokes using the ink decoder</h3>
<p>Create a <a href="../api-WCMInkDecoder/index.html"><code>WCMInkDecoder</code></a> instance. Initialize it with the data contents of the paths element.</p>
<p>Call the <code>decodePathToPoints:</code> method until it returns <code>NO</code>, which indicates that there are no remaining strokes to decode.</p>
<p>The completed code is as follows:</p>
<pre><code class="objectivec">- (NSMutableArray*) decodeStrokesFromDocumentPath:(NSString*)path
{
    WCMDocument * doc = [[WCMDocument alloc] init];

    [doc loadDocumentAtPath:path];

    WCMDocumentSection * section = doc.sections[0];
    WCMDocumentSectionPaths * pathsElement = section.subelements[0];
    NSData * inkData = [pathsElement.content loadData];

    WCMInkDecoder * decoder = [[WCMInkDecoder alloc] initWithData:inkData];

    WCMFloatVector* strokePoints;
    unsigned int strokeStride;
    float strokeWidth;
    UIColor* strokeColor;
    float strokeStartValue;
    float strokeFinishValue;
    WCMBlendMode blendMode;

    NSMutableArray * strokes = [[NSMutableArray alloc] init];

    while([decoder decodePathToPoints:&amp;strokePoints
                            andStride:&amp;strokeStride
                             andWidth:&amp;strokeWidth
                             andColor:&amp;strokeColor
                                andTs:&amp;strokeStartValue
                                andTf:&amp;strokeFinishValue
                         andBlendMode:&amp;blendMode])
    {
        Stroke * stroke = [Stroke strokeWithPoints:strokePoints
                                         andStride:strokeStride
                                          andWidth:strokeWidth
                                          andColor:strokeColor
                                             andTs:strokeStartValue
                                             andTf:strokeFinishValue
                                      andBlendMode:blendMode];
        [strokes addObject:stroke];
    }

    return strokes;
}
</code></pre>
<h3>Step 8: Draw the decoded strokes</h3>
<p>Create a method to draw the strokes array to the screen using the following code:</p>
<pre><code class="objectivec">- (void) redrawStrokes
{
    [willContext setTarget:strokesLayer];
    [willContext clearColor:[UIColor clearColor]];

    WCMStrokeRenderer * renderer = [willContext strokeRendererWithSize:viewLayer.bounds.size andScaleFactor:viewLayer.scaleFactor];
    renderer.brush = pathBrush;

    for (Stroke * s in strokes)
    {
        renderer.stride = s.stride;
        renderer.width = s.width;
        renderer.color = s.color;
        renderer.ts = s.ts;
        renderer.tf = s.tf;

        [renderer resetAndClearBuffers];
        [renderer drawPoints:s.points.pointer finishStroke:YES];
        [renderer blendStrokeInLayer:strokesLayer withBlendMode:s.blendMode];
    }

    [self refreshViewInRect:viewLayer.bounds];
}</code></pre>
<p>This method creates a temporary instance of the <a href="../api-WCMStrokeRenderer/index.html"><code>WCMStrokeRenderer</code></a> class called <code>renderer</code>. The temporary instance is initialized with the size and scale factor of the view. For each stroke, the <code>renderer</code> is configured with the stroke parameters (<em>width</em>, <em>color</em>, <em>stride</em>, and so on). The stroke is then drawn and blended into the <code>strokesLayer</code>. Before drawing each stroke, you must call the <code>[renderer resetAndClearBuffers]</code> method.</p>
<h2>Next steps</h2>
<p>At this point, you can  progress to <a href="../tutorials-tutorial3/index.html">Tutorial 3: Erasing strokes</a>.</p>
</div> <!-- page -->
			<nav class="prev-next-page">
									<a href="../tutorials-tutorial2-part1/index.html" class="prev-page">&laquo; Part 1: Creating a stroke model</a>
								</nav>
			</div> <!-- page_content -->

	</div><!-- #sitewrapper -->

	<footer>
		<img src="../../wp-content/themes/will-doc/images/img_logo_wacom.png" alt="" />
<!--
		<span>&nbsp;</span>
		<a href="/contact.html">Contact</a>
		<a href="/support.html">Support</a>
-->
	</footer>
</body>
</html>