<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 7) & !(IE 8)]><!-->
<html lang="en-US">
<!--<![endif]-->
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<title>Part 2: Building paths from touch input | WILL SDK Docs</title>
	<link rel="profile" href="http://gmpg.org/xfn/11">
	<link rel="pingback" href="http://localhost/will_docs_instance1/xmlrpc.php">
	<!--[if lt IE 9]>
	<script src="http://localhost/will_docs_instance1/wp-content/themes/will-doc/js/html5.js"></script>
	<![endif]-->

	<link rel="stylesheet" href="../../wp-content/themes/will-doc/css/style.css">
	<link rel="stylesheet" href="../../wp-content/themes/will-doc/css/accordionmenu.css">

	<script src="../../wp-content/themes/will-doc/js/jquery.min.js"></script>
	<script src="../../wp-content/themes/will-doc/js/sidebar.js"></script>

	<link rel="stylesheet" href="../../wp-content/themes/will-doc/css/highlight.css">
	<script src="../../wp-content/themes/will-doc/js/highlight.pack.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
</head>

<body>
	<header>
		<div class="title">
			<div>WILL &trade;</div>
			<div>sdk documentation</div>
		</div>
		<!--
		<div id="searchbox">
			<input class="typeahead" type="text" placeholder="{{ search_text }}">
		</div>
-->
	</header>

	<div id="sitewrapper">
<div id="sidebar">
	<nav class="accordion">

				<h1 class="do-not-cause-collapse" title="General Concepts">

			General Concepts
			</h1>

							<div class="active-menu never-close">
					<h2 class="not-collapsible" title="Architectural Overview">

								<a href="../../general-concepts/architecture/index.html"
											>Architectural Overview</a>
					
			</h2>

						<h2 class="not-collapsible" title="Generating ink content">

								<a href="../../general-concepts/path-building/index.html"
											>Generating ink content</a>
					
			</h2>

						<h2 class="not-collapsible" title="Rendering ink content">

								<a href="../../general-concepts/rasterizer/index.html"
											>Rendering ink content</a>
					
			</h2>

						<h2 class="not-collapsible" title="Encoding and decoding ink content">

								<a href="../../general-concepts/serialization/index.html"
											>Encoding and decoding ink content</a>
					
			</h2>

						<h2 class="not-collapsible" title="Exchanging ink content">

								<a href="../../general-concepts/file-format/index.html"
											>Exchanging ink content</a>
					
			</h2>

							</div>
							<h1 title="iOS SDK">

			iOS SDK
			</h1>

							<div>
					<h2 title="Getting started">

								<a href="../getting-started/index.html"
											>Getting started</a>
					
			</h2>

						<h2 title="Release Notes">

								<a href="../release-notes/index.html"
											>Release Notes</a>
					
			</h2>

						<h2 title="Tutorials Overview">

								<a href="../tutorials/index.html"
											>Tutorials Overview</a>
					
			</h2>

							<div>
					<h3 title="Tutorial 1: Drawing with touch">

								<a href="../tutorials-tutorial1/index.html"
											>Tutorial 1: Drawing with touch</a>
					
			</h3>

							<div>
					<h4 title="Part 1: Setting up the ink engine">

								<a href="../tutorials-tutorial1-part1/index.html"
											>Part 1: Setting up the ink engine</a>
					
			</h4>

						<h4 title="Part 2: Building paths from touch input">

								<a href="index.html"
						 class="selected"					>Part 2: Building paths from touch input</a>
					
			</h4>

						<h4 title="Part 3: Smoothing paths">

								<a href="../tutorials-tutorial1-part3/index.html"
											>Part 3: Smoothing paths</a>
					
			</h4>

						<h4 title="Part 4: Drawing semi-transparent strokes">

								<a href="../tutorials-tutorial1-part4/index.html"
											>Part 4: Drawing semi-transparent strokes</a>
					
			</h4>

						<h4 title="Part 5: Drawing preliminary paths">

								<a href="../tutorials-tutorial1-part5/index.html"
											>Part 5: Drawing preliminary paths</a>
					
			</h4>

						<h4 title="Part 6: Using a particle brush">

								<a href="../tutorials-tutorial1-part6/index.html"
											>Part 6: Using a particle brush</a>
					
			</h4>

						<h4 title="Part 7: Generating a Bezier path">

								<a href="../tutorials-tutorial1-part7/index.html"
											>Part 7: Generating a Bezier path</a>
					
			</h4>

							</div>
							<h3 title="Tutorial 2: Encoding and decoding strokes">

								<a href="../tutorials-tutorial2/index.html"
											>Tutorial 2: Encoding and decoding strokes</a>
					
			</h3>

							<div>
					<h4 title="Part 1: Creating a stroke model">

								<a href="../tutorials-tutorial2-part1/index.html"
											>Part 1: Creating a stroke model</a>
					
			</h4>

						<h4 title="Part 2: Serializing and deserializing strokes">

								<a href="../tutorials-tutorial2-part2/index.html"
											>Part 2: Serializing and deserializing strokes</a>
					
			</h4>

							</div>
							<h3 title="Tutorial 3: Erasing strokes">

								<a href="../tutorials-tutorial3/index.html"
											>Tutorial 3: Erasing strokes</a>
					
			</h3>

							<div>
					<h4 title="Part 1: Extending the stroke model">

								<a href="../tutorials-tutorial3-part1/index.html"
											>Part 1: Extending the stroke model</a>
					
			</h4>

						<h4 title="Part 2: Creating an eraser">

								<a href="../tutorials-tutorial3-part2/index.html"
											>Part 2: Creating an eraser</a>
					
			</h4>

						<h4 title="Part 3: Erasing parts of strokes">

								<a href="../tutorials-tutorial3-part3/index.html"
											>Part 3: Erasing parts of strokes</a>
					
			</h4>

							</div>
							<h3 title="Tutorial 4: Selecting strokes">

								<a href="../tutorials-tutorial4/index.html"
											>Tutorial 4: Selecting strokes</a>
					
			</h3>

							<div>
					<h4 title="Part 1: Selecting whole strokes">

								<a href="../tutorials-tutorial4-part1/index.html"
											>Part 1: Selecting whole strokes</a>
					
			</h4>

						<h4 title="Part 2: Selecting parts of strokes">

								<a href="../tutorials-tutorial4-part2/index.html"
											>Part 2: Selecting parts of strokes</a>
					
			</h4>

							</div>
							<h3 title="Tutorial 5: Working with rasters">

								<a href="../tutorials-tutorial5/index.html"
											>Tutorial 5: Working with rasters</a>
					
			</h3>

							<div>
					<h4 title="Part 1: Displaying raster images">

								<a href="../tutorials-tutorial5-part1/index.html"
											>Part 1: Displaying raster images</a>
					
			</h4>

						<h4 title="Part 2: Creating image masks">

								<a href="../tutorials-tutorial5-part2/index.html"
											>Part 2: Creating image masks</a>
					
			</h4>

							</div>
								</div>
							<h2 title="API Reference">

			API Reference
			</h2>

							<div>
					<h3 title="Classes">

			Classes
			</h3>

							<div>
					<h4 title="WCMAbstractPathBuilder">

								<a href="../api-WCMAbstractPathBuilder/index.html"
											>WCMAbstractPathBuilder</a>
					
			</h4>

						<h4 title="WCMBezierPathUtils">

								<a href="../api-WCMBezierPathUtils/index.html"
											>WCMBezierPathUtils</a>
					
			</h4>

						<h4 title="WCMCGRectVector">

								<a href="../api-WCMCGRectVector/index.html"
											>WCMCGRectVector</a>
					
			</h4>

						<h4 title="WCMDirectStrokeBrush">

								<a href="../api-WCMDirectStrokeBrush/index.html"
											>WCMDirectStrokeBrush</a>
					
			</h4>

						<h4 title="WCMDocument">

								<a href="../api-WCMDocument/index.html"
											>WCMDocument</a>
					
			</h4>

						<h4 title="WCMDocumentContentType">

								<a href="../api-WCMDocumentContentType/index.html"
											>WCMDocumentContentType</a>
					
			</h4>

						<h4 title="WCMDocumentProperties">

								<a href="../api-WCMDocumentProperties/index.html"
											>WCMDocumentProperties</a>
					
			</h4>

						<h4 title="WCMDocumentResource">

								<a href="../api-WCMDocumentResource/index.html"
											>WCMDocumentResource</a>
					
			</h4>

						<h4 title="WCMDocumentSection">

								<a href="../api-WCMDocumentSection/index.html"
											>WCMDocumentSection</a>
					
			</h4>

						<h4 title="WCMDocumentSectionContainer">

								<a href="../api-WCMDocumentSectionContainer/index.html"
											>WCMDocumentSectionContainer</a>
					
			</h4>

						<h4 title="WCMDocumentSectionElement">

								<a href="../api-WCMDocumentSectionElement/index.html"
											>WCMDocumentSectionElement</a>
					
			</h4>

						<h4 title="WCMDocumentSectionGroup">

								<a href="../api-WCMDocumentSectionGroup/index.html"
											>WCMDocumentSectionGroup</a>
					
			</h4>

						<h4 title="WCMDocumentSectionImage">

								<a href="../api-WCMDocumentSectionImage/index.html"
											>WCMDocumentSectionImage</a>
					
			</h4>

						<h4 title="WCMDocumentSectionPaths">

								<a href="../api-WCMDocumentSectionPaths/index.html"
											>WCMDocumentSectionPaths</a>
					
			</h4>

						<h4 title="WCMDocumentSectionRect">

								<a href="../api-WCMDocumentSectionRect/index.html"
											>WCMDocumentSectionRect</a>
					
			</h4>

						<h4 title="WCMDocumentSectionView">

								<a href="../api-WCMDocumentSectionView/index.html"
											>WCMDocumentSectionView</a>
					
			</h4>

						<h4 title="WCMFloatVector">

								<a href="../api-WCMFloatVector/index.html"
											>WCMFloatVector</a>
					
			</h4>

						<h4 title="WCMFloatVectorPointer">

								<a href="../api-WCMFloatVectorPointer/index.html"
											>WCMFloatVectorPointer</a>
					
			</h4>

						<h4 title="WCMInkDecoder">

								<a href="../api-WCMInkDecoder/index.html"
											>WCMInkDecoder</a>
					
			</h4>

						<h4 title="WCMInkEncoder">

								<a href="../api-WCMInkEncoder/index.html"
											>WCMInkEncoder</a>
					
			</h4>

						<h4 title="WCMIntVector">

								<a href="../api-WCMIntVector/index.html"
											>WCMIntVector</a>
					
			</h4>

						<h4 title="WCMIntersector">

								<a href="../api-WCMIntersector/index.html"
											>WCMIntersector</a>
					
			</h4>

						<h4 title="WCMLayer">

								<a href="../api-WCMLayer/index.html"
											>WCMLayer</a>
					
			</h4>

						<h4 title="WCMMultiChannelSmoothener">

								<a href="../api-WCMMultiChannelSmoothener/index.html"
											>WCMMultiChannelSmoothener</a>
					
			</h4>

						<h4 title="WCMPaintDecoder">

								<a href="../api-WCMPaintDecoder/index.html"
											>WCMPaintDecoder</a>
					
			</h4>

						<h4 title="WCMPaintEncoder">

								<a href="../api-WCMPaintEncoder/index.html"
											>WCMPaintEncoder</a>
					
			</h4>

						<h4 title="WCMParticlePaint">

								<a href="../api-WCMParticlePaint/index.html"
											>WCMParticlePaint</a>
					
			</h4>

						<h4 title="WCMParticleStrokeBrush">

								<a href="../api-WCMParticleStrokeBrush/index.html"
											>WCMParticleStrokeBrush</a>
					
			</h4>

						<h4 title="WCMPathAppendResult">

								<a href="../api-WCMPathAppendResult/index.html"
											>WCMPathAppendResult</a>
					
			</h4>

						<h4 title="WCMPressurePathBuilder">

								<a href="../api-WCMPressurePathBuilder/index.html"
											>WCMPressurePathBuilder</a>
					
			</h4>

						<h4 title="WCMRIFFChunk">

								<a href="../api-WCMRIFFChunk/index.html"
											>WCMRIFFChunk</a>
					
			</h4>

						<h4 title="WCMRIFFDecoder">

								<a href="../api-WCMRIFFDecoder/index.html"
											>WCMRIFFDecoder</a>
					
			</h4>

						<h4 title="WCMRIFFEncoder">

								<a href="../api-WCMRIFFEncoder/index.html"
											>WCMRIFFEncoder</a>
					
			</h4>

						<h4 title="WCMRenderingContext">

								<a href="../api-WCMRenderingContext/index.html"
											>WCMRenderingContext</a>
					
			</h4>

						<h4 title="WCMSmoothener">

								<a href="../api-WCMSmoothener/index.html"
											>WCMSmoothener</a>
					
			</h4>

						<h4 title="WCMSmoothenerFinisher">

								<a href="../api-WCMSmoothenerFinisher/index.html"
											>WCMSmoothenerFinisher</a>
					
			</h4>

						<h4 title="WCMSolidColorStrokeBrush">

								<a href="../api-WCMSolidColorStrokeBrush/index.html"
											>WCMSolidColorStrokeBrush</a>
					
			</h4>

						<h4 title="WCMSpeedPathBuilder">

								<a href="../api-WCMSpeedPathBuilder/index.html"
											>WCMSpeedPathBuilder</a>
					
			</h4>

						<h4 title="WCMStrokeBrush">

								<a href="../api-WCMStrokeBrush/index.html"
											>WCMStrokeBrush</a>
					
			</h4>

						<h4 title="WCMStrokeRenderer">

								<a href="../api-WCMStrokeRenderer/index.html"
											>WCMStrokeRenderer</a>
					
			</h4>

						<h4 title="WCMTransformableProtocol">

								<a href="../api-WCMTransformableProtocol/index.html"
											>WCMTransformableProtocol</a>
					
			</h4>

						<h4 title="WCMVersion">

								<a href="../api-WCMVersion/index.html"
											>WCMVersion</a>
					
			</h4>

						<h4 title="WCMWILLFileFormatDecoder">

								<a href="../api-WCMWILLFileFormatDecoder/index.html"
											>WCMWILLFileFormatDecoder</a>
					
			</h4>

						<h4 title="WCMWILLFileFormatEncoder">

								<a href="../api-WCMWILLFileFormatEncoder/index.html"
											>WCMWILLFileFormatEncoder</a>
					
			</h4>

							</div>
							<h3 title="Constants">

			Constants
			</h3>

							<div>
					<h4 title="WCMBlendMode">

								<a href="../api-WCMBlendMode/index.html"
											>WCMBlendMode</a>
					
			</h4>

						<h4 title="WCMInputPhase">

								<a href="../api-WCMInputPhase/index.html"
											>WCMInputPhase</a>
					
			</h4>

						<h4 title="WCMPropertyFunction">

								<a href="../api-WCMPropertyFunction/index.html"
											>WCMPropertyFunction</a>
					
			</h4>

						<h4 title="WCMPropertyName">

								<a href="../api-WCMPropertyName/index.html"
											>WCMPropertyName</a>
					
			</h4>

						<h4 title="WCMStrokeBrushRotation">

								<a href="../api-WCMStrokeBrushRotation/index.html"
											>WCMStrokeBrushRotation</a>
					
			</h4>

							</div>
							<h3 title="Index">

								<a href="../api-index/index.html"
											>Index</a>
					
			</h3>

						<h3 title="Hierarchy">

								<a href="../api-hierarchy/index.html"
											>Hierarchy</a>
					
			</h3>

			
	</nav>
</div><div id="page_content" class='page-content tutorials ios'>
	<div class="seealso"><h2>See Also</h2><p>For more information, see the following topic:</p><ul><li><a href="../../general-concepts/path-building/index.html">Generating ink content</a></li></ul></div>
<div id="post-67" class="page">
	<h1>Drawing with touch</h1>
<h2>Part 2: Building paths from touch input</h2>
<p>In Part 2 of this tutorial, you will construct a builder that creates paths based on touch input.</p>
<h3>Step 1: Create a path builder</h3>
<p>The path builder is the component that calculates the geometry of the strokes using the touch input. In this tutorial, you use the <a href="../../iOS/api-WCMSpeedPathBuilder/index.html"><code>WCMSpeedPathBuilder</code></a> class. With this class, the width of the stroke changes depending on the speed at which the user moves their finger.</p>
<p>Create the path builder, as follows:</p>
<pre><code class="objectivec">    WCMSpeedPathBuilder * pathBuilder;</code></pre>
<p>Configure the path builder so that it produces paths with variable widths depending on the speed. To do this, add the following code to the <code>initWillContext:</code> method:</p>
<pre><code class="objectivec">        pathBuilder = [[WCMSpeedPathBuilder alloc] init];
        [pathBuilder setNormalizationConfigWithMinValue:0 andMaxValue:7000];
        [pathBuilder setPropertyConfigWithName:WCMPropertyNameWidth andMinValue:2 andMaxValue:15 andInitialValue:NAN andFinalValue:NAN andFunction:WCMPropertyFunctionPower andParameter:1 andFlip:NO];</code></pre>
<p>The path builder is configured to produce strokes with a width between 2 and 15. It does not assume any particular unit of measurement. For this tutorial, you feed the path builder with coordinates measured in iOS points, which is the most common usage. The width of the strokes produced will also be in points.</p>
<p>The configuration specifies that when the touch is stationary, the stroke has the minimum width of 2 points. When the touch speed increases to 7,000 points per second, the width of the stroke becomes 15 points. Speed values above that value are capped to 7,000 points per second.</p>
<p>The <em>andFunction:WCMPropertyFunctionPower andParameter:1</em> parameters specify that the width increases linearly as the speed increases. The <em>andFlip:NO</em> parameter specifies that the minimum width applies to the minimum speed, and the maximum width applies to the maximum speed.</p>
<h3>Step 2: Create a member variable of the <code>WCMStrokeRenderer</code> class</h3>
<p>Create a member variable of the <a href="../../iOS/api-WCMStrokeRenderer/index.html"><code>WCMStrokeRenderer</code></a> class using the following code:</p>
<pre><code class="objectivec">    WCMStrokeRenderer * strokeRenderer;</code></pre>
<p>Add the following code to the <code>initWillContext:</code> method:</p>
<pre><code class="objectivec">        strokeRenderer = [willContext strokeRendererWithSize:viewLayer.bounds.size andScaleFactor:viewLayer.scaleFactor];

        strokeRenderer.brush = [willContext solidColorBrush];
        strokeRenderer.stride = [pathBuilder calculateStride];
        strokeRenderer.color = [UIColor blackColor];</code></pre>
<h3>Step 3: Manage the touch events</h3>
<p>Add the following code to handle the touch events:</p>
<pre><code class="objectivec">-(void) touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event
{
    [self processTouches:touches withEvent:event];
}

-(void) touchesMoved:(NSSet *)touches withEvent:(UIEvent *)event
{
    [self processTouches:touches withEvent:event];
}

-(void) touchesEnded:(NSSet *)touches withEvent:(UIEvent *)event
{
    [self processTouches:touches withEvent:event];
}

-(void) touchesCancelled:(NSSet *)touches withEvent:(UIEvent *)event
{
    [self processTouches:touches withEvent:event];
}</code></pre>
<h3>Step 4: Manage the event processing</h3>
<p>Add the following code to handle the event processing:</p>
<pre><code class="objectivec">- (void) processTouches:(NSSet *)touches withEvent:(UIEvent *)event
{
    UITouch * touch = [touches anyObject];

    if (touch.phase != UITouchPhaseStationary)
    {
        CGPoint location = [touch locationInView:self];
        WCMInputPhase wcmInputPhase;

        if (touch.phase == UITouchPhaseBegan)
        {
            wcmInputPhase = WCMInputPhaseBegin;
        }
        else if (touch.phase == UITouchPhaseMoved)
        {
            wcmInputPhase = WCMInputPhaseMove;
        }
        else if (touch.phase == UITouchPhaseEnded || touch.phase == UITouchPhaseCancelled)
        {
            wcmInputPhase = WCMInputPhaseEnd;
        }

        WCMFloatVectorPointer * points = [pathBuilder addPointWithPhase:wcmInputPhase andX:location.x andY:location.y andTimestamp:touch.timestamp];
        WCMPathAppendResult* pathAppendResult = [pathBuilder addPathPart:points];

        [strokeRenderer drawPoints:pathAppendResult.addedPath finishStroke:wcmInputPhase == WCMInputPhaseEnd];

        [self refreshViewInRect:strokeRenderer.updatedArea];
    }
}</code></pre>
<p>The <code>[pathBuilder addPointWithPhase:wcmInputPhase andX:location.x andY:location.y andTimestamp:touch.timestamp]</code> method call calculates a set of points that represent the stroke geometry (the position and width). You can modify the list that is returned (for example, in the next part of this tutorial you will smooth out noise in the input). For now, add it to the current path using the <code>[pathBuilder addPathPart:points]</code> call.</p>
<p><strong>Note:</strong> After the calls to the path builder, the control points of the stroke are stored in the <code>pathAppendResult</code> object. The <em>wholePath</em> property contains the whole path build up to this point. You use the <em>addedPath</em> property because you want to draw only the part added during this event loop.</p>
<h3>Step 5: Change the screen update method</h3>
<p>Change the <code>refreshView:</code> method to <code>refreshViewInRect:</code>. This setting allows you to update only the area of the screen that has been changed (using the <code>updatedArea</code> property of the <code>strokeRenderer</code>). This setting is an important performance optimization.</p>
<pre><code class="objectivec">-(void) refreshViewInRect:(CGRect)rect
{
    [willContext setTarget:viewLayer andClipRect:rect];
    [willContext clearColor:[UIColor whiteColor]];

    [strokeRenderer blendStrokeUpdatedAreaInLayer:viewLayer withBlendMode:WCMBlendModeNormal];

    [viewLayer present];
}</code></pre>
<p>Use the <code>[strokeRenderer blendStrokeUpdatedAreaInLayer:viewLayer withBlendMode:WCMBlendModeNormal]</code> method to blend only the area where the stroke is updated. The stroke is updated by the <code>[WCMStrokeRenderer drawPoints:finishStroke:]</code> call.</p>
<p>You might notice that the strokes are jagged. This is due to the noise in the input data from the user’s touch input. In the next part of this tutorial, you will solve this issue.</p>
<h2>Next steps</h2>
<p>At this point, you can continue with this tutorial, or you can progress to <a href="../tutorials-tutorial2/index.html">Tutorial 2: Encoding and decoding strokes</a>.</p>
</div> <!-- page -->
			<nav class="prev-next-page">
									<a href="../tutorials-tutorial1-part1/index.html" class="prev-page">&laquo; Part 1: Setting up the ink engine</a>
										<a href="../tutorials-tutorial1-part3/index.html" class="next-page">Part 3: Smoothing paths &raquo;</a>
								</nav>
			</div> <!-- page_content -->

	</div><!-- #sitewrapper -->

	<footer>
		<img src="../../wp-content/themes/will-doc/images/img_logo_wacom.png" alt="" />
<!--
		<span>&nbsp;</span>
		<a href="/contact.html">Contact</a>
		<a href="/support.html">Support</a>
-->
	</footer>
</body>
</html>